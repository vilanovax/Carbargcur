/**
 * Domain Keywords - کلمات کلیدی تخصصی برای هر حوزه
 * Used for calculating domain keyword density in answers
 */

export const domainKeywords: Record<string, string[]> = {
  // حسابداری
  accounting: [
    "ثبت", "سند", "دفتر", "معین", "کل", "تراز", "آزمایشی",
    "بدهکار", "بستانکار", "مانده", "صورت‌حساب", "ترازنامه",
    "سود", "زیان", "درآمد", "هزینه", "دارایی", "بدهی",
    "سرمایه", "استهلاک", "ذخیره", "موجودی", "انبار",
    "اسناد", "دریافتنی", "پرداختنی", "حساب", "تعدیل",
    "بستن", "افتتاح", "جاری", "بلندمدت", "کوتاه‌مدت",
    "صورت‌های مالی", "یادداشت", "اظهارنامه", "حسابداری",
  ],

  // مالی
  finance: [
    "تأمین مالی", "سرمایه‌گذاری", "بازده", "ریسک", "نقدینگی",
    "جریان نقدی", "ارزش فعلی", "ارزش آتی", "NPV", "IRR",
    "وام", "تسهیلات", "اعتبار", "سود", "بهره", "نرخ",
    "سهام", "اوراق", "بدهی", "حقوق صاحبان",
    "تحلیل مالی", "نسبت‌های مالی", "سودآوری", "اهرم",
    "بازار سرمایه", "بورس", "فرابورس", "عرضه", "تقاضا",
  ],

  // مالیات
  tax: [
    "مالیات", "مالیاتی", "اظهارنامه", "سازمان امور مالیاتی",
    "مالیات بر درآمد", "مالیات بر ارزش افزوده", "ارزش افزوده",
    "معافیت", "تخفیف", "جریمه", "دیرکرد", "تبصره",
    "ماده", "قانون", "آیین‌نامه", "بخشنامه", "دستورالعمل",
    "حسابرسی مالیاتی", "ممیز", "هیئت حل اختلاف",
    "علی‌الحساب", "قطعی", "تشخیص", "مطالبه",
    "نرخ مالیات", "پایه مالیاتی", "مؤدی", "عملکرد",
  ],

  // بیمه
  insurance: [
    "بیمه", "بیمه‌گر", "بیمه‌گذار", "حق بیمه", "پوشش",
    "خسارت", "غرامت", "فرانشیز", "بیمه‌نامه", "الحاقیه",
    "بیمه عمر", "بیمه درمان", "بیمه تأمین اجتماعی",
    "بیمه مسئولیت", "بیمه آتش‌سوزی", "بیمه شخص ثالث",
    "سابقه بیمه", "بازنشستگی", "مستمری", "کارفرما",
    "لیست بیمه", "سازمان تأمین اجتماعی", "بیمه تکمیلی",
    "دفترچه", "تعهدات", "استثنائات", "ذینفع",
  ],

  // سرمایه‌گذاری / بورس
  investment: [
    "سهام", "سهامدار", "سود سهام", "DPS", "EPS",
    "P/E", "NAV", "صندوق", "ETF", "شاخص",
    "معامله", "خرید", "فروش", "سفارش", "کارگزاری",
    "کد بورسی", "سجام", "احراز هویت", "سبد",
    "پرتفوی", "تنوع‌بخشی", "تحلیل تکنیکال", "تحلیل بنیادی",
    "حمایت", "مقاومت", "روند", "کندل", "نمودار",
    "عرضه اولیه", "IPO", "افزایش سرمایه", "حق تقدم",
    "بازار اول", "بازار دوم", "تابلو", "نماد",
  ],

  // حسابرسی
  audit: [
    "حسابرسی", "حسابرس", "رسیدگی", "بررسی", "کنترل داخلی",
    "نمونه‌گیری", "شواهد", "مستندات", "تأییدیه",
    "گزارش حسابرس", "اظهارنظر", "مقبول", "مشروط",
    "عدم اظهارنظر", "مردود", "بند", "استاندارد حسابرسی",
    "تحریف", "اشتباه", "تقلب", "ریسک حسابرسی",
    "آزمون محتوا", "آزمون کنترل", "اهمیت", "تأیید",
  ],

  // بودجه
  budgeting: [
    "بودجه", "بودجه‌بندی", "برنامه‌ریزی", "پیش‌بینی",
    "انحراف", "واریانس", "عملکرد", "مصوب",
    "تخصیص", "اعتبار", "ردیف", "فصل",
    "درآمد", "هزینه", "جاری", "عمرانی",
    "منابع", "مصارف", "کنترل بودجه", "تراز",
  ],

  // بهای تمام‌شده
  cost: [
    "بهای تمام‌شده", "هزینه‌یابی", "مرکز هزینه",
    "هزینه ثابت", "هزینه متغیر", "هزینه مستقیم", "هزینه غیرمستقیم",
    "سربار", "تسهیم", "جذب", "استاندارد",
    "مواد", "دستمزد", "کار مستقیم", "تولید",
    "موجودی کالا", "کالای در جریان", "کالای ساخته‌شده",
    "سفارش کار", "مرحله‌ای", "ABC", "فعالیت",
    "نقطه سربه‌سر", "حاشیه فروش", "حاشیه سود",
  ],
};

/**
 * Calculate domain keyword density for given text and category
 */
export function calculateKeywordDensity(text: string, category: string): number {
  const keywords = domainKeywords[category];
  if (!keywords || keywords.length === 0) return 0;

  const words = text.split(/\s+/).filter(w => w.length > 1);
  if (words.length === 0) return 0;

  let hits = 0;
  const lowerText = text.toLowerCase();

  for (const keyword of keywords) {
    if (lowerText.includes(keyword.toLowerCase())) {
      hits++;
    }
  }

  // Normalize: hits per 100 words, capped at 1.0
  const density = Math.min((hits / Math.max(words.length, 1)) * 100, 1.0);
  return density;
}

/**
 * Check if text contains enough domain-specific keywords
 */
export function hasDomainKeywords(text: string, category: string, minHits: number = 2): boolean {
  const keywords = domainKeywords[category];
  if (!keywords || keywords.length === 0) return false;

  let hits = 0;
  const lowerText = text.toLowerCase();

  for (const keyword of keywords) {
    if (lowerText.includes(keyword.toLowerCase())) {
      hits++;
      if (hits >= minHits) return true;
    }
  }

  return false;
}
